#-------------------------------
#
#This input script is used to simulate the defected configuration generated by overlapping cascades initiated at 
#different energies
#Ziqiang Wang on 01/24/2022
#
#-------------------------------

clear
units                    metal
dimension                    3
boundary                 p p p
atom_style               full
atom_modify              map  array


variable                 numx     equal    5
variable                 numy     equal    60
variable                 numz     equal    5  
#firstly create face center cubic uranium sublattice
variable                 lat      equal    5.5788
lattice                  fcc       ${lat}
region                   ruranium  block  0  ${numx}  0  ${numy}  0  ${numz}  units  lattice
create_box               8         ruranium
change_box               all       triclinic
create_atoms             2         region  ruranium

#secondly create simple cubic oxygen sublattice
variable                 a         equal  ${lat}
variable                 fourth    equal  1.0/4.0
variable                 three4    equal  3.0/4.0
variable                 b       equal  ${fourth}
variable                 c       equal  ${three4}

lattice                  custom    1.0  a1 $a 0.0 0.0 &
                                        a2 0.0 $a 0.0 &
                                        a3 0.0 0.0 $a &
                                     basis $b $b $b &
                                     basis $c $b $b &
                                     basis $b $b $c &
                                     basis $c $b $c &
                                     basis $b $c $b &
                                     basis $c $c $b &
                                     basis $b $c $c &
                                     basis $c $c $c 
region                   roxygen   block  0  ${numx}  0  ${numy}  0  ${numz}  units  lattice
create_atoms             1         region  roxygen

#Thirdly create customed lattice inserted octahedral interstitial atoms
lattice                  custom    $a  a1  1.0  0.0  0.0  a2  0.0  1.0  0.0  a3  0.0  0.0  1.0 &
                         basis  0.5  0.0  0.0 & 
                         basis  0.0  0.5  0.0 &
                         basis  0.0  0.0  0.5 &
                         basis  0.5  0.5  0.5 
region                   roct      block  0  ${numx}  0  ${numy}  0  ${numz}  units  lattice
create_atoms             3         region  roct  &
                         basis     3     4       &
                         basis     4     4

mass                     1       15.99
mass                     2      232.038
mass                     3       15.99
mass                     4      232.038
mass                     5       15.99
mass                     6      232.038
mass                     7       15.99
mass                     8      232.038

kspace_style                   pppm            1.0e-5
pair_style                     hybrid/overlay     coul/long    11.0   eam/alloy
pair_coeff                     * * coul/long
pair_coeff                     * * eam/alloy CeThUNpPuAmCmO.eam.alloy O Th O Th O Th O Th
neighbor                 2.0  bin
neigh_modify             delay  0  every  1  check   yes 

# Create the Frenkel pairs in the relaxed perfect crystal
variable                 ntot equal     ${numx}*${numy}*${numz}*12

# Specifize the concentration of the defects
variable                 N      equal     0.25
variable                 r      equal     $N/100
variable                 third  equal     1/3
variable                 two3   equal     2/3
if '$N == 0' then 'variable onum equal 0' 'variable unum equal 0'
if '$N == 0.25' then 'variable onum equal ${ntot}*$r*${two3}' 'variable unum equal ${ntot}*$r*${third}'
if '$N == 0.5' then 'variable onum equal ${ntot}*$r*${two3}' 'variable unum equal ${ntot}*$r*${third}'
if '$N == 1' then 'variable onum equal ${ntot}*$r*${two3}' 'variable unum equal ${ntot}*$r*${third}'
if '$N == 2' then 'variable onum equal ${ntot}*$r*${two3}' 'variable unum equal ${ntot}*$r*${third}'
if '$N == 5' then 'variable onum equal ${ntot}*$r*${two3}' 'variable unum equal ${ntot}*$r*${third}'

variable                 otot    equal   ${numx}*${numy}*${numz}*8
variable                 utot    equal   ${numx}*${numy}*${numz}*4
variable                 oratio  equal   ${onum}/${otot}  # ration between the removed O sublattice and total O 
variable                 uratio  equal   ${unum}/${utot}  # sublattices

variable                 octOnum    equal   ${numx}*${numy}*${numz}*2-${onum} # number of the deleted oct O atoms
variable                 octnum     equal   ${numx}*${numy}*${numz}*2
variable                 octOratio  equal   ${octOnum}/${octnum}
variable                 octUnum    equal   ${numx}*${numy}*${numz}*2-${unum} # number of the deleted oct Th atoms
variable                 octUratio  equal   ${octUnum}/${octnum}


group                    oxygen    type    1
group                    uranium   type    2
group                    octoxygen type    3
group                    octuran   type    4
set                      group     oxygen     type/ratio  5  ${oratio}  5561  
set                      group     uranium    type/ratio  6  ${uratio}  65548
set                      group     octoxygen  type/ratio  7  ${octOratio} 745415
set                      group     octuran    type/ratio  8  ${octUratio} 85328

group                    odel      type    5
group                    udel      type    6
group                    octOdel   type    7
group                    octUdel   type    8
delete_atoms             group     odel
delete_atoms             group     udel
delete_atoms             group     octOdel
delete_atoms             group     octUdel

group                    1     union    oxygen    octoxygen
group                    2     union    uranium   octuran

set                      group     1      type     1
set                      group     2      type     2

set                      type      1      charge    -1.1104
set                      type      2      charge     2.2208

# Minimize the defected configuration at 0K
min_style                cg
fix                      relax   all  box/relax  aniso 0.0 vmax 0.001
minimize                 1.0e-30 1.0e-30 10000 10000
unfix                    relax
reset_timestep           0

# Apply the temperature to the system and relax the configurations
reset_atom_ids
variable                 latt   equal  (lx/5+ly/60+lz/5)/3
variable                 temp   index  600
velocity                 all  create  ${temp}  1001  rot  yes  mom  yes  dist  gaussian
fix                      npt  all  npt  temp  ${temp}  ${temp}  $(100*dt)  aniso  0.0  0.0  $(1000*dt)
timestep                 0.001
thermo                   50000
thermo_style             custom  step  temp time dt atoms etotal  ke  pe  press v_latt

shell                    mkdir   Frenkel_${N}_relax
dump                     1  all  custom  50000  ./Frenkel_${N}_relax/dump_relax.atom.*  id type q mass x y z 
dump_modify              1  element  O Th O Th O Th O Th

run                      100000
shell                    mkdir  thermal_condu
write_data               ./thermal_condu/Frenkel_${N}_relaxed.dat

